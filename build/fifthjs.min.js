var pstack=[],rstack=[],isCompiling=!1,withinComment=!1,input_words="",compiling_word={name:"",data:""},words={"+":function(){pstack.push(pstack.pop()+pstack.pop())},"-":function(){pstack.push(pstack.pop()-pstack.pop())},"*":function(){pstack.push(pstack.pop()*pstack.pop())},"/":function(){pstack.push(pstack.pop()/pstack.pop())},"=":function(){pstack.push(booleanify(pstack.pop()==pstack.pop()))},MOD:function(){pstack.push(pstack.pop()%pstack.pop())},ABS:function(){pstack.push(Math.abs(pstack.pop()))},MIN:function(){pstack.push(Math.min(pstack.pop(),pstack.pop()))},MAX:function(){pstack.push(Math.max(pstack.pop(),pstack.pop()))},FLOOR:function(){pstack.push(Math.floor(pstack.pop()))},ROUND:function(){pstack.push(Math.round(pstack.pop()))},DUP:function(){var a=pstack.pop();pstack.push(a),pstack.push(a)},SWAP:function(){var a=pstack.pop(),b=pstack.pop();pstack.push(a),pstack.push(b)},DROP:function(){pstack.pop()},ROT:function(){var a=pstack.pop(),b=pstack.pop(),c=pstack.pop();pstack.push(b),pstack.push(a),pstack.push(c)},NIP:function(){pstack.splice(-2,1)},TUCK:function(){var a=pstack[pstack.length-1];pstack.splice(-2,0,a)},OVER:function(){pstack.push(pstack[pstack.length-2])},ROLL:function(){pstack.push(pstack.splice(-(pstack.pop()+1),1))},PICK:function(){var a=pstack.pop()+1;pstack.push(pstack[pstack.length-a])},"2DROP":"DROP DROP",">R":function(){rstack.push(pstack.pop())},"R>":function(){pstack.push(rstack.pop())},"R@":function(){pstack.push(rstack[rstack.length-1])},J:function(){pstack.push(rstack[rstack.length-3])},I:"R@",":":function(){isCompiling=!0},";":function(){compile()},"(":function(){withinComment=!0},")":function(){withinComment=!1},".":function(){printReturn(pstack.pop())},".S":function(){printReturn("<"+pstack.length+"> "+pstack.join(" "))},PAGE:function(){document.getElementById("foutput").value=""},WORDS:function(){printReturn(Object.keys(words).join(" "))},CLEARSTACK:function(){pstack=[]},EMIT:function(){printReturn(String.fromCharCode(pstack.pop()))},CR:function(){printReturn("\n")}},printStd=function(a){document.getElementById("foutput").value+=a},printReturn=function(a){printStd(" "+a)},printOk=function(){printStd("  ok\n")},printErr=function(a){printStd("\nError: "+a+"\n")},compile=function(){if(!isCompiling)throw"Not in compile mode!";if(""===compiling_word.name)throw"No name has been declared for the word to be compiled!";words[compiling_word.name]=compiling_word.data.trim(),compiling_word={name:"",data:""},isCompiling=!1},isNumber=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},isWord=function(a){return a in words},booleanify=function(a){return a?-1:0},parseToken=function(a){if(""!=a.trim())if(isCompiling&&";"!==a)""===compiling_word.name?compiling_word.name=a:compiling_word.data+=a+" ";else if(isNumber(a))pstack.push(parseFloat(a));else if(isWord(a)){var b=words[a];b instanceof Function?words[a]():parseLine(b)}else if(!withinComment)throw"Undefined word >"+a+"<"},parseLine=function(a,b){var c=a.split(" ");try{for(var d=0;d<c.length&&"//"!==c[d];d++)parseToken(c[d]);b&&printOk()}catch(e){printErr(e)}},parseUserInput=function(a){a=a.trim(),printStd(a),parseLine(a,!0)};